import{S as T,U as w,i as m,ac as F,ad as _,e as C,r as y,aa as R,ab as v,x as S,ae as z,af as D,a as L,ag as j,v as B}from"./_virtual_settings-ca773ca9.js";var d=globalThis&&globalThis.__decorate||function(l,e,t,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(l,e,t,n);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(s=(i<3?r(s):i>3?r(e,t,s):r(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},x;let o=x=class extends T{constructor({children:e,...t}){super(t),e&&this.text(e)}parentTxt(){const e=this.parent();return e instanceof c?e:null}async draw(e){this.requestFontUpdate(),this.applyStyle(e),this.applyText(e),e.font=this.styles.font,"letterSpacing"in e&&(e.letterSpacing=`${this.letterSpacing()}px`);const t=this.element.getBoundingClientRect(),{width:n,height:i}=this.size(),s=document.createRange();let r="";const a=new w;for(const f of this.element.childNodes){if(!f.textContent)continue;s.selectNodeContents(f);const h=s.getBoundingClientRect(),b=n/-2+h.left-t.left,g=i/-2+h.top-t.top;a.y===g?(a.width+=h.width,r+=f.textContent):(await this.drawText(e,r,a),a.x=b,a.y=g,a.width=h.width,a.height=h.height,r=f.textContent)}await this.drawText(e,r,a)}async drawText(e,t,n){await new Promise(s=>document.fonts.ready.then(s));const i=n.y+n.height/2;e.save(),e.textBaseline="middle",t=t.replace(/\s+/g," "),this.lineWidth()<=0?e.fillText(t,n.x,i):this.strokeFirst()?(e.strokeText(t,n.x,i),e.fillText(t,n.x,i)):(e.fillText(t,n.x,i),e.strokeText(t,n.x,i)),e.restore()}getCacheBBox(){const e=this.computedSize(),t=document.createRange();t.selectNodeContents(this.element);const n=t.getBoundingClientRect(),i=this.lineWidth(),s=this.lineJoin()==="miter"?.5*10:.5;return new w(-e.width/2,-e.height/2,n.width,n.height).expand([0,this.fontSize()*.5]).expand(i*s)}applyFlex(){super.applyFlex(),this.element.style.display="inline"}updateLayout(){if(this.applyFont(),this.applyFlex(),this.justifyContent.isInitial()&&(this.element.style.justifyContent=this.styles.getPropertyValue("text-align")),this.styles.whiteSpace!=="nowrap"&&this.styles.whiteSpace!=="pre")if(this.element.innerText="",x.segmenter)for(const t of x.segmenter.segment(this.text()))this.element.appendChild(document.createTextNode(t.segment));else for(const t of this.text().split(""))this.element.appendChild(document.createTextNode(t));else if(this.styles.whiteSpace==="pre"){this.element.innerText="";for(const t of this.text().split(`
`))this.element.appendChild(document.createTextNode(t+`
`))}else this.element.innerText=this.text()}};d([m(""),F(_),C()],o.prototype,"text",void 0);d([y()],o.prototype,"parentTxt",null);d([R(()=>{const l=document.createElement("span");return v.shadowRoot.append(l),l})],o,"formatter",void 0);d([R(()=>{try{return new Intl.Segmenter(void 0,{granularity:"grapheme"})}catch{return null}})],o,"segmenter",void 0);o=x=d([S("TxtLeaf")],o);["fill","stroke","lineWidth","strokeFirst","lineCap","lineJoin","lineDash","lineDashOffset"].forEach(l=>{o.prototype[`get${z(l)}`]=function(){var e;return((e=this.parentTxt())==null?void 0:e[l]())??this[l].context.getInitial()}});var u=globalThis&&globalThis.__decorate||function(l,e,t,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(l,e,t,n);else for(var a=l.length-1;a>=0;a--)(r=l[a])&&(s=(i<3?r(s):i>3?r(e,t,s):r(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},p;let c=p=class extends T{static b(e){return new p({...e,fontWeight:700})}static i(e){return new p({...e,fontStyle:"italic"})}getText(){return this.innerText()}setText(e){const t=this.children();let n=null;for(let i=0;i<t.length;i++){const s=t[i];n===null&&s instanceof o?n=s:s.parent(null)}n===null?(n=new o({text:e}),n.parent(this)):n.text(e),this.setParsedChildren([n])}setChildren(e){this.children.context.raw()!==e&&(typeof e=="string"?this.text(e):super.setChildren(e))}*tweenText(e,t,n,i){const s=this.children();(s.length!==1||!(s[0]instanceof o))&&this.text.save();const r=this.childAs(0),a=r.text.context.raw(),f=this.size.context.raw();r.text(e);const h=this.size();r.text(a??D),this.height()===0&&this.height(h.height),yield*L(this.size(h,t,n),r.text(e,t,n,i)),this.children.context.setter(e),this.size(f)}getLayout(){return!0}constructor({children:e,text:t,...n}){super(n),this.children(t??e)}innerText(){const e=this.childrenAs();let t="";for(const n of e)t+=n.text();return t}parentTxt(){const e=this.parent();return e instanceof p?e:null}parseChildren(e){const t=[],n=Array.isArray(e)?e:[e];for(const i of n)i instanceof p||i instanceof o?t.push(i):typeof i=="string"&&t.push(new o({text:i}));return t}applyFlex(){super.applyFlex(),this.element.style.display=this.findAncestor(j(p))?"inline":"block"}async draw(e){await this.drawChildren(e)}};u([m(""),C()],c.prototype,"text",void 0);u([B()],c.prototype,"tweenText",null);u([y()],c.prototype,"innerText",null);u([y()],c.prototype,"parentTxt",null);c=p=u([S("Txt")],c);["fill","stroke","lineWidth","strokeFirst","lineCap","lineJoin","lineDash","lineDashOffset"].forEach(l=>{c.prototype[`getDefault${z(l)}`]=function(e){var t;return((t=this.parentTxt())==null?void 0:t[l]())??e}});export{c as T};
